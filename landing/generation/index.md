
# ğŸš€ CharacterAPI.generation å››å±‚æ¶æ„ç´¢å¼•

> **æ ¸å¿ƒç›®æ ‡**ï¼šæä¾›ç»Ÿä¸€çš„AIç”Ÿæˆæ¥å£ï¼Œå°è£…å¹³å°å·®å¼‚ï¼Œæ”¯æŒé¢„è®¾ä¸è‡ªå®šä¹‰ç”Ÿæˆæ¨¡å¼ï¼Œå®ç°æµå¼å“åº”ä¸äº‹ä»¶é©±åŠ¨çš„å¯è§‚å¯Ÿæ¶æ„ã€‚

## ğŸ“‹ å¿«é€Ÿå¯¼èˆª

| æ¶æ„å±‚æ¬¡ | æ ¸å¿ƒèŒè´£ | æ¨èåº¦ | é€‚ç”¨åœºæ™¯ | æ–‡æ¡£é“¾æ¥ |
|----------|----------|--------|----------|----------|
| **åº•å±‚å¹³å°ç‰¹æ€§** | å¹³å°åŸç”Ÿèƒ½åŠ›å°è£… | â­â­â­ **å¿…éœ€** | æ‰€æœ‰ç”Ÿæˆåœºæ™¯ | [platform.md](./platform.md) |
| **å¹³å°é€‚é…å±‚** | ç»Ÿä¸€æ¥å£ä¸äº‹ä»¶æ¡¥æ¥ | â­â­â­ **å¿…éœ€** | å¤šå¹³å°æ”¯æŒ | [adapter.md](./adapter.md) |
| **åŒ…è£…å±‚å®ç°** | çŠ¶æ€ç®¡ç†ä¸é”™è¯¯å¤„ç† | â­â­â­ **å¿…éœ€** | ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ | [wrapper.md](./wrapper.md) |
| **åº”ç”¨å±‚é›†æˆ** | Vueç»„ä»¶ä¸UIé›†æˆ | â­â­ **æ¨è** | å‰ç«¯åº”ç”¨å¼€å‘ | [application.md](./application.md) |
| **é«˜çº§å“åº”å¼** | PiniaçŠ¶æ€ç®¡ç† | â­ **å¯é€‰æ‰©å±•** | å¤æ‚çŠ¶æ€åœºæ™¯ | [advanced-application.md](./advanced-application.md) |

## ğŸ—ï¸ æ¶æ„å±‚æ¬¡å›¾

```mermaid
graph TB
    subgraph "ğŸ¯ åº”ç”¨å±‚ (Application Layer)"
        A1[Vueç»„ä»¶é›†æˆ â­â­]
        A2[é«˜çº§å“åº”å¼ç®¡ç† â­]
    end
    
    subgraph "ğŸ“¦ åŒ…è£…å±‚ (Wrapper Layer)"
        W1[GenerationManager â­â­â­]
        W2[çŠ¶æ€æœºç®¡ç† â­â­â­]
        W3[é”™è¯¯å¤„ç† â­â­â­]
    end
    
    subgraph "ğŸ”Œ é€‚é…å±‚ (Adapter Layer)"
        AD1[TavernHelperé€‚é…å™¨ â­â­â­]
        AD2[äº‹ä»¶å½’ä¸€åŒ– â­â­â­]
        AD3[å…¶ä»–å¹³å°é€‚é…å™¨ â­]
    end
    
    subgraph "âš¡ å¹³å°å±‚ (Platform Layer)"
        P1[TavernHelperåŸç”ŸAPI â­â­â­]
        P2[å…¶ä»–AIå¹³å° â­]
    end
    
    A1 --> W1
    A2 -.-> W1
    W1 --> AD1
    W2 --> AD2
    W3 --> AD1
    AD1 --> P1
    AD2 --> P1
    AD3 -.-> P2
    
    classDef required fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef recommended fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef optional fill:#fff3e0,stroke:#e65100,stroke-width:1px,stroke-dasharray: 5 5
    
    class W1,W2,W3,AD1,AD2,P1 required
    class A1 recommended
    class A2,AD3,P2 optional
```

## ğŸ’¡ å®æ–½ç­–ç•¥

### ğŸ¯ **æ¨èå®æ–½è·¯å¾„**
1. **æ ¸å¿ƒä¸‰å±‚ä¼˜å…ˆ** (â­â­â­)ï¼šPlatform â†’ Adapter â†’ Wrapper
2. **åº”ç”¨å±‚é›†æˆ** (â­â­)ï¼šåŸºç¡€Vueç»„ä»¶é›†æˆ
3. **å¯é€‰æ‰©å±•** (â­)ï¼šé«˜çº§å“åº”å¼ç®¡ç†


---

## ğŸ¯ æ ¸å¿ƒç›®æ ‡ä¸ç‰¹æ€§

### âœ… **ç»Ÿä¸€æ¥å£è®¾è®¡**
- å°†å¹³å°å·®å¼‚å°è£…åˆ°é€‚é…å™¨ä¸­ï¼Œè°ƒç”¨è€…ä»…ä¾èµ– [`CharacterAPI.generation`](./wrapper.md#_2-1-æ ¸å¿ƒæ¥å£å®ç°)
- æ”¯æŒé¢„è®¾ç”Ÿæˆä¸è‡ªå®šä¹‰ç”Ÿæˆä¸¤ç§æ¨¡å¼

### âœ… **å…¨é‡ç‰¹æ€§æ”¯æŒ**
- ä¼˜å…ˆå®ç° RFC è§„èŒƒæè¿°çš„ [`generate`](/CHARACTER_API_RFC) / [`generateRaw`](/CHARACTER_API_RFC) èƒ½åŠ›
- æ”¯æŒæç¤ºè¯è¦†ç›–ã€æ³¨å…¥ã€å†å²ç®¡ç†ã€å›¾ç‰‡è¾“å…¥ã€è‡ªå®šä¹‰APIé…ç½®
- å®Œæ•´çš„äº‹ä»¶ä¸æµå¼å“åº”æ”¯æŒ

### âœ… **å¯è§‚å¯Ÿæ€§æ¶æ„**
- ä¸æ•™ç¨‹åŒ…è£…å±‚æ‰“é€šï¼Œæ ‡å‡†åŒ–äº‹ä»¶ä¸æ—¥å¿—è¾“å‡º
- æ”¯æŒç”Ÿæˆè¿‡ç¨‹å›æ”¾ä¸è¯Šæ–­
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ä¸çŠ¶æ€ç®¡ç†

### âœ… **å¯æ‰©å±•æ€§è®¾è®¡**
- ä¿ç•™ä¸å…¶ä»–å¹³å°é€‚é…çš„ä¸€è‡´å…¥å£ä¸ç±»å‹
- æ¨¡å—åŒ–çš„ç»„ä»¶è®¾è®¡ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½

---

## ğŸ”§ æ ¸å¿ƒæ¥å£ä¸ç±»å‹å®šä¹‰

### ğŸ“‹ **ç”Ÿæˆé€‰é¡¹æ¥å£** â­â­â­
> **èŒè´£**ï¼šå®šä¹‰é¢„è®¾ä¸è‡ªå®šä¹‰ç”Ÿæˆæ¨¡å¼çš„ç»Ÿä¸€å‚æ•°æ¥å£
> **å¿…è¦æ€§**ï¼š**ç»å¯¹å¿…éœ€** - æ‰€æœ‰ç”Ÿæˆæ“ä½œçš„åŸºç¡€ç±»å‹å®šä¹‰

```typescript
// é¢„è®¾æ¨¡å¼ç”Ÿæˆé€‰é¡¹ï¼ˆæ˜ å°„ TavernHelper GenerateConfigï¼‰
export interface PresetGenerationOptions {
  user_input?: string;              // ç”¨æˆ·è¾“å…¥å†…å®¹
  image?: File | string | (File | string)[]; // å›¾ç‰‡è¾“å…¥æ”¯æŒ
  stream?: boolean;                 // æµå¼å“åº”å¼€å…³
  overrides?: Overrides;            // æç¤ºè¯è¦†ç›–é…ç½®
  injects?: Omit<InjectionPrompt, 'id'>[]; // æç¤ºè¯æ³¨å…¥
  max_chat_history?: 'all' | number; // å†å²æ¶ˆæ¯é™åˆ¶
  custom_api?: CustomApiConfig;     // è‡ªå®šä¹‰APIé…ç½®
  generation_id?: string;           // ç”Ÿæˆå”¯ä¸€æ ‡è¯†
}

// è‡ªå®šä¹‰æ¨¡å¼ç”Ÿæˆé€‰é¡¹ï¼ˆæ˜ å°„ TavernHelper GenerateRawConfigï¼‰
export interface RawGenerationOptions extends PresetGenerationOptions {
  ordered_prompts?: (BuiltinPrompt | RolePrompt)[]; // è‡ªå®šä¹‰æç¤ºè¯åºåˆ—
}

// æµå¼å†…å®¹ä¼ é€’é€‰é¡¹
export interface StreamDeliveryOptions {
  stream_use_incremental?: boolean; // å¢é‡å†…å®¹æ¨é€ (é»˜è®¤: true)
  stream_use_full?: boolean;        // å®Œæ•´å¿«ç…§æ¨é€ (é»˜è®¤: false)
}
```

> ğŸ“– **å®Œæ•´ç±»å‹å®šä¹‰å‚è€ƒ**ï¼š[wrapper.md - æ ¸å¿ƒæ¥å£å®ç°](./wrapper.md#_2-1-æ ¸å¿ƒæ¥å£å®ç°)

### ğŸ›ï¸ **ç”Ÿæˆç®¡ç†å™¨æ¥å£** â­â­â­
> **èŒè´£**ï¼šæä¾›ç»Ÿä¸€çš„ç”Ÿæˆæ“ä½œå…¥å£ä¸ç”Ÿå‘½å‘¨æœŸç®¡ç†
> **å¿…è¦æ€§**ï¼š**ç»å¯¹å¿…éœ€** - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å°è£…

```typescript
interface GenerationManager {
  // é¢„è®¾æ¨¡å¼ç”Ÿæˆ
  generateWithPreset(options: PresetGenerationOptions): Promise<GenerationResult>;
  
  // è‡ªå®šä¹‰æ¨¡å¼ç”Ÿæˆ
  generateRaw(options: RawGenerationOptions): Promise<GenerationResult>;
  
  // åœæ­¢ç”Ÿæˆ
  stop(generationId: string): Promise<void>;
  
  // äº‹ä»¶è®¢é˜…
  on(event: GenerationEvent, handler: EventHandler): void;
}
```

---

## ğŸ“¡ äº‹ä»¶é©±åŠ¨æ¶æ„

### ğŸ”„ **äº‹ä»¶æµç¨‹å›¾** â­â­â­

```mermaid
sequenceDiagram
    participant App as åº”ç”¨å±‚
    participant Wrapper as åŒ…è£…å±‚
    participant Adapter as é€‚é…å±‚
    participant Platform as å¹³å°å±‚
    
    App->>Wrapper: generateWithPreset(options)
    Wrapper->>Adapter: é€‚é…å™¨è°ƒç”¨
    Adapter->>Platform: åŸç”ŸAPIè°ƒç”¨
    
    Platform-->>Adapter: generation:started
    Adapter-->>Wrapper: äº‹ä»¶å½’ä¸€åŒ–
    Wrapper-->>App: onGenerationStart
    
    Platform-->>Adapter: generation:progress
    Adapter-->>Wrapper: æµå¼å†…å®¹å¤„ç†
    Wrapper-->>App: onGenerationProgress
    
    Platform-->>Adapter: generation:ended
    Adapter-->>Wrapper: ç»“æœå°è£…
    Wrapper-->>App: onGenerationComplete
```

### ğŸ“‹ **æ ‡å‡†äº‹ä»¶ç±»å‹** â­â­â­
| äº‹ä»¶åç§° | è§¦å‘æ—¶æœº | æ•°æ®è½½è· | å¿…è¦æ€§ |
|----------|----------|----------|--------|
| `generation:started` | ç”Ÿæˆå¼€å§‹ | `{ generationId, timestamp }` | â­â­â­ |
| `generation:progress` | æµå¼å†…å®¹ | `{ content, isIncremental }` | â­â­â­ |
| `generation:ended` | ç”Ÿæˆå®Œæˆ | `{ result, duration }` | â­â­â­ |
| `generation:error` | ç”Ÿæˆé”™è¯¯ | `{ error, context }` | â­â­â­ |

> ğŸ“– **äº‹ä»¶è¯¦ç»†è¯´æ˜**ï¼š[adapter.md - äº‹ä»¶å½’ä¸€åŒ–ä¸æ¡¥æ¥](./adapter.md#_2-äº‹ä»¶å½’ä¸€åŒ–ä¸æ¡¥æ¥)

---

## ğŸ—ï¸ åˆ†å±‚å®ç°æŒ‡å—

### 1ï¸âƒ£ **åº•å±‚å¹³å°ç‰¹æ€§** â­â­â­ **å¿…éœ€**
> **å®æ–½ä¼˜å…ˆçº§**ï¼šç¬¬ä¸€é˜¶æ®µ - åŸºç¡€èƒ½åŠ›è°ƒç ”

- **æ ¸å¿ƒèƒ½åŠ›**ï¼šTavernHelperåŸç”ŸAPIå°è£…
- **å…³é”®ç‰¹æ€§**ï¼šç”Ÿæˆæ¨¡å¼ã€äº‹ä»¶ç³»ç»Ÿã€æµå¼å“åº”ã€æç¤ºè¯ç®¡ç†
- **å®ç°è¦ç‚¹**ï¼šå¹³å°èƒ½åŠ›æ¸…å•ã€APIæ¥å£æ˜ å°„ã€å…¼å®¹æ€§åˆ†æ

ğŸ“– **è¯¦ç»†å®ç°**ï¼š[platform.md - å¹³å°ç‰¹æ€§åˆ†æ](./platform.md)

### 2ï¸âƒ£ **å¹³å°é€‚é…å±‚** â­â­â­ **å¿…éœ€**
> **å®æ–½ä¼˜å…ˆçº§**ï¼šç¬¬äºŒé˜¶æ®µ - ç»Ÿä¸€æ¥å£è®¾è®¡

- **æ ¸å¿ƒèƒ½åŠ›**ï¼šSPIåˆåŒå®šä¹‰ã€äº‹ä»¶å½’ä¸€åŒ–ã€è¿è¡Œæ—¶åå•†
- **å…³é”®ç‰¹æ€§**ï¼šé€‚é…å™¨å·¥å‚ã€èƒ½åŠ›å£°æ˜ã€é™çº§ç­–ç•¥
- **å®ç°è¦ç‚¹**ï¼šæ¥å£æ ‡å‡†åŒ–ã€äº‹ä»¶æ¡¥æ¥ã€é”™è¯¯æ˜ å°„

ğŸ“– **è¯¦ç»†å®ç°**ï¼š[adapter.md - é€‚é…å™¨è®¾è®¡](./adapter.md)

### 3ï¸âƒ£ **åŒ…è£…å±‚å®ç°** â­â­â­ **å¿…éœ€**
> **å®æ–½ä¼˜å…ˆçº§**ï¼šç¬¬ä¸‰é˜¶æ®µ - ä¸šåŠ¡é€»è¾‘å°è£…

- **æ ¸å¿ƒèƒ½åŠ›**ï¼šGenerationManagerã€çŠ¶æ€æœºã€å¹¶å‘æ§åˆ¶
- **å…³é”®ç‰¹æ€§**ï¼šç»Ÿä¸€è°ƒç”¨æ¥å£ã€é”™è¯¯å¤„ç†ã€èµ„æºç®¡ç†
- **å®ç°è¦ç‚¹**ï¼šç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é‡è¯•æœºåˆ¶ã€æ—¥å¿—é›†æˆ

ğŸ“– **è¯¦ç»†å®ç°**ï¼š[wrapper.md - åŒ…è£…å±‚è®¾è®¡](./wrapper.md)

### 4ï¸âƒ£ **åº”ç”¨å±‚é›†æˆ** â­â­ **æ¨è**
> **å®æ–½ä¼˜å…ˆçº§**ï¼šç¬¬å››é˜¶æ®µ - å‰ç«¯é›†æˆ

- **æ ¸å¿ƒèƒ½åŠ›**ï¼šVueç»„ä»¶é›†æˆã€UIçŠ¶æ€åŒæ­¥ã€ç”¨æˆ·äº¤äº’
- **å…³é”®ç‰¹æ€§**ï¼šå“åº”å¼ç»‘å®šã€é”™è¯¯æç¤ºã€è¿›åº¦æ˜¾ç¤º
- **å®ç°è¦ç‚¹**ï¼šç»„ä»¶è®¾è®¡ã€çŠ¶æ€ç®¡ç†ã€ç”¨æˆ·ä½“éªŒ

ğŸ“– **è¯¦ç»†å®ç°**ï¼š[application.md - åº”ç”¨å±‚é›†æˆ](./application.md)

### 5ï¸âƒ£ **é«˜çº§å“åº”å¼** â­ **å¯é€‰æ‰©å±•**
> **å®æ–½ä¼˜å…ˆçº§**ï¼šç¬¬äº”é˜¶æ®µ - é«˜çº§ç‰¹æ€§

- **æ ¸å¿ƒèƒ½åŠ›**ï¼šPiniaçŠ¶æ€ç®¡ç†ã€å¤æ‚ä¸šåŠ¡åœºæ™¯æ”¯æŒ
- **å…³é”®ç‰¹æ€§**ï¼šå…¨å±€çŠ¶æ€ã€æŒä¹…åŒ–ã€å¤šå®ä¾‹ç®¡ç†
- **å®ç°è¦ç‚¹**ï¼šçŠ¶æ€è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–ã€æ‰©å±•æœºåˆ¶

ğŸ“– **è¯¦ç»†å®ç°**ï¼š[advanced-application.md - é«˜çº§åº”ç”¨](./advanced-application.md)

---

## ğŸ§ª æµ‹è¯•ä¸éªŒæ”¶ç­–ç•¥

### âœ… **æµ‹è¯•è¦†ç›–çŸ©é˜µ**
| æµ‹è¯•å±‚çº§ | è¦†ç›–èŒƒå›´ | æµ‹è¯•é‡ç‚¹ | éªŒæ”¶æ ‡å‡† |
|----------|----------|----------|----------|
| **å•å…ƒæµ‹è¯•** | å„å±‚ç»„ä»¶ | æ¥å£å¥‘çº¦ã€é”™è¯¯å¤„ç† | è¦†ç›–ç‡ > 90% |
| **é›†æˆæµ‹è¯•** | è·¨å±‚äº¤äº’ | äº‹ä»¶æµè½¬ã€çŠ¶æ€åŒæ­¥ | ç«¯åˆ°ç«¯åœºæ™¯é€šè¿‡ |
| **æ€§èƒ½æµ‹è¯•** | å¹¶å‘åœºæ™¯ | å“åº”æ—¶é—´ã€èµ„æºå ç”¨ | æ»¡è¶³æ€§èƒ½åŸºçº¿ |

### ğŸ“‹ **éªŒæ”¶æ£€æŸ¥æ¸…å•**
- [ ] æ˜¯å¦æ”¯æŒé¢„è®¾ä¸è‡ªå®šä¹‰ä¸¤ç§ç”Ÿæˆæ¨¡å¼ï¼Ÿ
- [ ] æ˜¯å¦å®ç°å®Œæ•´çš„äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Ÿ
- [ ] æ˜¯å¦æä¾›ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Ÿ
- [ ] æ˜¯å¦æ”¯æŒæµå¼å“åº”ä¸è¿›åº¦åé¦ˆï¼Ÿ
- [ ] æ˜¯å¦å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§è®¾è®¡ï¼Ÿ

> ğŸ“– **æµ‹è¯•è¯¦ç»†æŒ‡å—**ï¼šåç»­è¡¥å……

---

## ğŸ”— ç›¸å…³èµ„æºé“¾æ¥

### ğŸ“š **æ ¸å¿ƒæ–‡æ¡£**
- [CharacterAPI RFC](/CHARACTER_API_RFC) - æ•´ä½“æ¶æ„ä¸æ¥å£è§„èŒƒ
- [ç”Ÿæˆæ¨¡å—ç´¢å¼•](/landing/generation/) - åˆ†æ­¥å®ç°ä¸å¯¼èˆª

### ğŸ› ï¸ **å®ç°å‚è€ƒ**
- [åŒ…è£…å±‚å®ç°](./wrapper.md) - ç»Ÿä¸€æ¥å£ä¸äº‹ä»¶å¤„ç†
- [é€‚é…å™¨è®¾è®¡](./adapter.md) - å¹³å°å·®å¼‚å°è£…ä¸æ¡¥æ¥

### ğŸ¯ **å¿«é€Ÿå¯¼èˆª**
| æ–‡æ¡£ | ç”¨é€” | æ¨èåº¦ |
|------|------|--------|
| [platform.md](./platform.md) | å¹³å°èƒ½åŠ›åˆ†æ | â­â­â­ |
| [adapter.md](./adapter.md) | é€‚é…å™¨è®¾è®¡ | â­â­â­ |
| [wrapper.md](./wrapper.md) | åŒ…è£…å±‚å®ç° | â­â­â­ |
| [application.md](./application.md) | åº”ç”¨å±‚é›†æˆ | â­â­ |
| [advanced-application.md](./advanced-application.md) | é«˜çº§ç‰¹æ€§ | â­ |
